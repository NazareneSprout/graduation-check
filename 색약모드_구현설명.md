# 색약 모드 구현 설명서

> 비개발자도 이해할 수 있도록 작성된 기술 문서입니다.

---

## 📋 목차

1. [전체 개요](#전체-개요)
2. [왜 이렇게 만들었나요?](#왜-이렇게-만들었나요)
3. [어떻게 작동하나요?](#어떻게-작동하나요)
4. [상세 구현 설명](#상세-구현-설명)
5. [사용자 경험 흐름](#사용자-경험-흐름)

---

## 전체 개요

### 무엇을 만들었나요?

앱 전체를 **흑백(회색톤)**으로 표시하는 "색약 전용 모드"를 만들었습니다.

### 왜 필요한가요?

색약이 있는 분들은 빨강, 초록 등의 색상 구별이 어려울 수 있습니다.
흑백으로 표시하면 색상 대신 **밝기의 차이**로 정보를 전달할 수 있어 더 명확하게 볼 수 있습니다.

### 핵심 기능

✅ 버튼 한 번으로 앱 전체가 흑백으로 변환
✅ 텍스트와 배경이 선명하게 구분됨 (가독성 보장)
✅ 설정이 저장되어 앱을 껐다 켜도 유지됨
✅ 언제든 다시 원래 색상으로 돌아갈 수 있음

---

## 왜 이렇게 만들었나요?

### 1. 전체 앱에 일괄 적용이 필요했습니다

**문제점**: 앱에는 수십 개의 화면이 있는데, 각 화면마다 일일이 색상을 바꾸면...
- 시간이 엄청 오래 걸림 (각 화면마다 수정)
- 실수로 빠뜨린 화면이 생길 수 있음
- 나중에 새로운 화면을 추가할 때마다 또 작업해야 함

**해결 방법**: "기본 틀"을 만들어서 모든 화면이 자동으로 따라하게 만들었습니다.

### 2. 사용자가 직접 켜고 끌 수 있어야 했습니다

**이유**: 색약이 없는 사람에게는 흑백 화면이 불편할 수 있으니까요.

**해결 방법**: 설정 메뉴에서 체크박스로 간편하게 선택할 수 있게 만들었습니다.

### 3. 한 번 설정하면 계속 유지되어야 했습니다

**이유**: 앱을 끌 때마다 다시 설정하면 너무 불편하니까요.

**해결 방법**: 휴대폰 안에 설정을 저장해서 앱을 다시 켜도 그대로 적용되게 만들었습니다.

---

## 어떻게 작동하나요?

### 🎨 흑백 변환 원리

**비유로 설명하면**:

컬러 사진을 흑백 사진으로 바꾸는 것과 같습니다.

1. **원본**: 빨강, 파랑, 노랑 등 여러 색상이 있습니다
2. **변환**: 색상의 "채도"를 0으로 만듭니다
   - 채도 = 색의 선명함, 진함
   - 채도 0 = 색이 없음 = 회색
3. **결과**: 모든 색이 밝기만 남은 회색톤으로 변합니다

**중요**: 밝기는 유지되므로
- 밝은 파랑 → 밝은 회색
- 어두운 빨강 → 어두운 회색
- 따라서 텍스트와 배경의 구분이 명확하게 유지됩니다!

### 📱 앱에서의 작동 순서

```
1. 사용자가 "색약 전용 모드" 체크박스를 켭니다
   ↓
2. 휴대폰 저장소에 "색약모드 = 켜짐" 이라고 기록됩니다
   ↓
3. 앱이 재시작됩니다
   ↓
4. 앱이 시작될 때 저장소를 확인합니다
   ↓
5. "색약모드 = 켜짐"을 발견하면 흑백 필터를 적용합니다
   ↓
6. 모든 화면이 흑백으로 표시됩니다
```

---

## 상세 구현 설명

### 📁 파일 1: `UserProfileFragment.java`

**역할**: 사용자가 설정을 선택하는 화면

#### 🔧 무엇을 했나요?

1. **설정 저장 공간 만들기**
   ```
   비유: 휴대폰 안에 "접근성 설정" 이름의 서랍을 만듭니다
   ```

2. **현재 설정 불러오기**
   ```
   서랍을 열어서 "색약모드"가 켜져있는지 확인합니다
   체크박스에 현재 상태를 표시합니다
   ```

3. **새로운 설정 저장하기**
   ```
   사용자가 체크박스를 누르면
   → 서랍에 새로운 설정을 기록합니다
   → "색약모드 = 켜짐" 또는 "색약모드 = 꺼짐"
   ```

4. **앱 재시작**
   ```
   설정이 바뀌면 전체 화면을 새로 그려야 하므로
   앱을 완전히 껐다가 다시 켭니다
   (마치 컴퓨터를 재부팅하는 것과 비슷합니다)
   ```

#### 💡 왜 재시작이 필요한가요?

- 이미 화면에 그려진 내용은 바꾸기 어렵습니다
- 새로 시작하면서 처음부터 흑백으로 그리는 것이 더 확실합니다
- 사용자 경험상 1~2초 정도만 기다리면 되므로 크게 불편하지 않습니다

---

### 📁 파일 2: `BaseActivity.java`

**역할**: 모든 화면의 "기본 틀" (흑백 필터를 적용하는 핵심 부분)

#### 🔧 무엇을 했나요?

1. **화면이 시작될 때마다 확인**
   ```
   새로운 화면이 열릴 때마다
   → "색약모드가 켜져있나?" 확인합니다
   → 켜져있으면 흑백 필터를 적용합니다
   ```

2. **흑백 필터 만들기**
   ```
   ColorMatrix라는 도구를 사용합니다
   (컬러 사진을 흑백으로 바꾸는 필터와 같습니다)

   채도(saturation)를 0으로 설정합니다
   → 모든 색상이 회색으로 변합니다
   ```

3. **화면 전체에 필터 적용**
   ```
   Window의 DecorView = 화면의 최상위 레이어
   (모든 내용이 그려지는 캔버스라고 생각하면 됩니다)

   이 캔버스에 흑백 필터를 씌웁니다
   → 그 위에 그려지는 모든 것이 흑백으로 표시됩니다
   ```

#### 💡 기술 상세 설명

**ColorMatrix란?**
- 색상을 수학적으로 계산하는 도구입니다
- 빨강(R), 초록(G), 파랑(B) 값을 조합해서 새로운 색을 만듭니다

**Saturation(채도)을 0으로 만든다는 것은?**
```
예시:
- 빨강(R=255, G=0, B=0) → 회색(R=128, G=128, B=128)
- 파랑(R=0, G=0, B=255) → 회색(R=128, G=128, B=128)
- 밝은 노랑(R=255, G=255, B=0) → 밝은 회색(R=200, G=200, B=200)

즉, RGB 값의 평균을 내서 모든 색을 회색으로 만듭니다
```

**LAYER_TYPE_HARDWARE란?**
```
하드웨어 가속 모드입니다
GPU(그래픽 카드)를 사용해서 빠르게 처리합니다

비유:
- LAYER_TYPE_NONE = 연필로 그림
- LAYER_TYPE_HARDWARE = 인쇄기로 출력
  → 더 빠르고 부드럽게 화면이 표시됩니다
```

#### 🎯 왜 DecorView에 적용하나요?

**DecorView = 화면의 최상위 레이어**

```
앱 화면의 구조:

┌─────────────────────────────┐
│    DecorView (최상위)       │  ← 여기에 필터 적용!
│  ┌─────────────────────────┐│
│  │   Status Bar (상태바)   ││
│  ├─────────────────────────┤│
│  │   Toolbar (툴바)        ││
│  ├─────────────────────────┤│
│  │   Content (내용)        ││
│  │   - 텍스트              ││
│  │   - 이미지              ││
│  │   - 버튼                ││
│  ├─────────────────────────┤│
│  │   Bottom Navigation     ││
│  └─────────────────────────┘│
└─────────────────────────────┘

최상위에 필터를 씌우면
→ 그 아래 모든 요소가 자동으로 흑백으로 표시됩니다!
```

---

### 📁 파일 3: `MainActivityNew.java`

**역할**: 앱의 메인 화면 (홈, 시간표, 지도, 내정보 탭이 있는 화면)

#### 🔧 무엇을 했나요?

1. **상속 관계 변경**
   ```
   이전: AppCompatActivity를 상속
   이후: BaseActivity를 상속
   ```

2. **이게 무슨 의미인가요?**
   ```
   비유로 설명:

   AppCompatActivity = 기본 화면 틀
   BaseActivity = 기본 화면 틀 + 흑백 필터 기능

   MainActivityNew가 BaseActivity를 상속받으면
   → 자동으로 흑백 필터 기능을 물려받습니다
   ```

#### 💡 상속이란?

**쉬운 비유: 부모와 자식 관계**

```
부모(BaseActivity):
- 화면 만들기 기능 ✓
- 흑백 필터 적용 기능 ✓

자식(MainActivityNew):
- 부모의 모든 기능을 물려받음
- 추가로 탭 전환 기능도 있음

결과:
MainActivityNew는 자동으로 흑백 필터를 적용할 수 있습니다!
```

---

## 사용자 경험 흐름

### 🎬 시나리오: 색약 모드 켜기

```
1단계: 설정 메뉴 열기
└─ 사용자가 "내 정보" 탭을 누릅니다
└─ "장애학생 배려 모드" 버튼이 보입니다

2단계: 옵션 선택
└─ 버튼을 누르면 다이얼로그가 나타납니다
└─ "색약 전용 모드" 체크박스가 보입니다
└─ 체크박스를 선택합니다

3단계: 설정 저장
└─ "적용" 버튼을 누릅니다
└─ 휴대폰 저장소에 설정이 기록됩니다
    → SharedPreferences: { "color_blind_mode": true }

4단계: 앱 재시작
└─ 토스트 메시지가 표시됩니다
    → "적용되었습니다: 색약 전용 모드. 앱을 재시작합니다."
└─ 1~2초 후 앱이 재시작됩니다

5단계: 흑백 모드 적용
└─ 앱이 시작되면서 BaseActivity가 실행됩니다
└─ SharedPreferences를 확인합니다
    → "color_blind_mode"가 true입니다
└─ 흑백 필터를 적용합니다
└─ 모든 화면이 흑백으로 표시됩니다! ✨
```

### 🎬 시나리오: 색약 모드 끄기

```
1~4단계는 동일 (체크박스만 해제)

5단계: 컬러 모드 복원
└─ SharedPreferences를 확인합니다
    → "color_blind_mode"가 false입니다
└─ 흑백 필터를 제거합니다
    → removeGrayscaleFilter() 실행
└─ 원래 색상으로 화면이 표시됩니다! 🎨
```

---

## 📊 기술적 장점

### 1. 성능 최적화

```
✓ GPU 가속 사용 (LAYER_TYPE_HARDWARE)
  → 부드러운 화면 전환
  → 배터리 효율적

✓ 한 번만 적용하면 됨
  → 매번 색상을 계산할 필요 없음
  → 앱 속도에 영향 없음
```

### 2. 유지보수 편의성

```
✓ 한 곳(BaseActivity)만 수정하면 전체 적용
  → 새로운 화면을 추가해도 자동으로 적용됨
  → 버그 수정이 쉬움

✓ 설정이 중앙에서 관리됨
  → SharedPreferences 한 곳에 저장
  → 데이터 동기화 문제 없음
```

### 3. 확장 가능성

```
✓ 다른 접근성 기능 추가 용이
  → BaseActivity에 기능만 추가하면 됨
  → 예: 큰 글씨 모드, 고대비 모드 등

✓ 기존 코드 변경 최소화
  → 각 화면 코드를 건드리지 않음
  → 안정성 유지
```

---

## 🔍 문제 해결 가이드

### Q1. 일부 화면만 흑백이 안 될 수 있나요?

**A**: 네, 가능합니다.

**원인**:
- 해당 화면이 BaseActivity를 상속받지 않았을 수 있습니다
- 또는 AppCompatActivity를 직접 상속받고 있을 수 있습니다

**해결 방법**:
```java
// 이전
public class SomeActivity extends AppCompatActivity {

// 이후
public class SomeActivity extends BaseActivity {
```

### Q2. 이미지도 흑백으로 변하나요?

**A**: 네, 모든 요소가 흑백으로 변합니다.

**이유**:
- DecorView 레이어에 필터를 적용했기 때문입니다
- 그 아래 모든 내용(텍스트, 이미지, 아이콘)이 흑백으로 표시됩니다

### Q3. 설정이 사라질 수 있나요?

**A**: 거의 없습니다.

**SharedPreferences는**:
- 앱을 삭제하기 전까지 계속 유지됩니다
- 휴대폰을 재부팅해도 유지됩니다
- 앱을 업데이트해도 유지됩니다

**단, 다음 경우에는 초기화됩니다**:
- 앱을 완전히 삭제하고 재설치한 경우
- 휴대폰 설정에서 "앱 데이터 삭제"를 한 경우

---

## 📚 관련 개념 정리

### ColorMatrix (컬러 매트릭스)

**무엇인가요?**
- 색상을 수학적으로 변환하는 도구입니다
- 5x4 행렬(숫자 표)로 색상 변환 규칙을 정의합니다

**어떻게 작동하나요?**
```
원본 색: R=255, G=0, B=0 (빨강)

Saturation 0으로 설정하면:
→ R, G, B의 평균을 계산합니다
→ (255 + 0 + 0) / 3 = 85
→ 결과: R=85, G=85, B=85 (어두운 회색)

원본 색: R=255, G=255, B=0 (노랑)
→ (255 + 255 + 0) / 3 = 170
→ 결과: R=170, G=170, B=170 (밝은 회색)
```

### SharedPreferences (공유 환경설정)

**무엇인가요?**
- 앱의 간단한 설정값을 저장하는 저장소입니다
- 키(key)와 값(value) 쌍으로 저장됩니다

**비유**:
```
일종의 "설정 노트"입니다

노트 이름: "accessibility_prefs"

페이지 내용:
- color_blind_mode = true
- option_2 = false
- option_3 = false
- option_4 = false
- option_5 = false
```

### 상속 (Inheritance)

**무엇인가요?**
- 부모 클래스의 기능을 자식 클래스가 물려받는 것입니다

**실제 예시**:
```
BaseActivity (부모):
├─ onCreate() - 화면 생성
├─ applyAccessibilitySettings() - 접근성 적용
└─ applyGrayscaleFilter() - 흑백 필터 적용

MainActivityNew (자식):
├─ [부모에게서 물려받은 기능들]
└─ setupBottomNavigation() - 탭 메뉴 설정 (자식만의 기능)
```

---

## 💡 핵심 요약

### 이렇게 3개 파일만 수정했습니다

1. **UserProfileFragment.java** (244줄)
   - 역할: 사용자 설정 저장
   - 핵심: SharedPreferences 사용

2. **BaseActivity.java** (신규, 68줄)
   - 역할: 흑백 필터 적용
   - 핵심: ColorMatrix + DecorView

3. **MainActivityNew.java** (1줄 수정)
   - 역할: BaseActivity 상속
   - 핵심: 자동으로 필터 적용됨

### 결과적으로

✅ 전체 앱이 흑백으로 변환
✅ 텍스트 가독성 유지
✅ 설정 저장 및 복원
✅ 확장 가능한 구조

---

## 🎯 마무리

이 문서는 **색약 모드** 기능이 어떻게 구현되었는지를
비개발자도 이해할 수 있도록 설명했습니다.

**핵심 원리**:
1. 색상의 채도를 0으로 만들어 흑백으로 변환
2. 화면의 최상위 레이어에 필터를 적용
3. 설정을 저장해서 앱 재시작 후에도 유지

**기술적 장점**:
- 간단하고 효율적인 구조
- 전체 앱에 일괄 적용
- 유지보수가 쉬움
- 다른 접근성 기능 추가 용이

---

**작성일**: 2025-01-13
**문서 버전**: 1.0
**작성자**: Claude (Anthropic AI)
